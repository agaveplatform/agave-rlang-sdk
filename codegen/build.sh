#!/bin/bash

# get script directory
AGAVE_R_SDK_HOME="$(dirname $( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd ) )"

# pull down the swagger def from the agave documentation site
curl -sk -o "$AGAVE_R_SDK_HOME/dist/agave.json" http://docs.agaveplatform.org/live-docs/agave.json

# run swagger codegen to get the first pass clients using
# the custom templates in the templates directory
java -jar modules/swagger-codegen-cli/target/swagger-codegen-cli.jar generate \
     -i "$AGAVE_R_SDK_HOME/dist/agave.json" \
     -l r \
     -t "$AGAVE_R_SDK_HOME/codegen/templates" \
     -o "$AGAVE_R_SDK_HOME/dist" \
     --api-package rAgave \
     --artifact-version 0.2.0 \
     --additional-properties packageVersion=0.2.0

# copy over the following static assets and custom classes to the dist directory
# Agave.r
# AgaveCache.r
# ApiClient.r
# Client.r
# ClientsApi.r
# FileInfo.r
# FilesApi.r
# Profile.r
# ProfilesApi.r
# Tenant.r
# TenantsApi.r
# Token.r
# TokensApi.r
# pylogger.r
# for i in `ls $AGAVE_R_SDK_HOME/codegen/custom/`; do    echo "Deleting autogenerated file $i to avoid overwriting the custom file"; echo "rm "$(pwd)"/out/rlang/$i"; ls ~/dockerspace/swagger-codegen/out/rlang/R/$i; done;
for i in `ls $AGAVE_R_SDK_HOME/codegen/custom/`;
do
   echo "Deleting autogenerated file $i to avoid overwriting the custom file"
   rm -f $AGAVE_R_SDK_HOME/dist/R/$i
done

cp -rf $AGAVE_R_SDK_HOME/codegen/custom/* $AGAVE_R_SDK_HOME/dist/R/
